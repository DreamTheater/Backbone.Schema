/*!
 * Backbone.Schema v0.2.0
 * https://github.com/DreamTheater/Backbone.Schema
 *
 * Copyright (c) 2013 Dmytro Nemoga
 * Released under the MIT license
 */
Backbone.Model=function(t){"use strict";return t.extend({constructor:function(){this._formatters={},this._converters={},t.apply(this,arguments)},get:_.wrap(t.prototype.get,function(t,e){var r=t.call(this,e);return this._computeValue(r,e)}),set:_.wrap(t.prototype.set,function(t,e,r,n){var u;!e||_.isObject(e)?(u=e,n=r):(u={})[e]=r;var i={};return _.each(u,function(t,e,r){var n=this._computeValues(r,e);_.extend(i,n)},this),t.call(this,i,n)}),toJSON:_.wrap(t.prototype.toJSON,function(t,e){e=e||{};var r=t.call(this,e);return e.schema&&_.each(this._formatters,function(t,e){r[e]=this.get(e)},this),r}),property:function(t,e){var r=this.constructor,n=r.formatters,u=r.converters,i=_.bind(n[e],n),o=_.bind(u[e],u),a=this.attributes[t];return this.computed(t,{getter:_.wrap(i,function(t,e,r){return t(e,r)}),setter:_.wrap(o,function(t,e,r){var n={};return n[e]=_.isNull(r)?r:_.isUndefined(r)?this._getDefaultValue(e):t(e,r),n})}),this.set(t,a),this},computed:function(t,e){return this._formatters[t]=e.getter,this._converters[t]=e.setter,this},_computeValue:function(t,e){var r=this._formatters[e];return r?r.call(this,e,t):t},_computeValues:function(t,e){var r=this._converters[e],n=t[e];return r?r.call(this,e,n):t},_getDefaultValue:function(t){var e,r=_.result(this,"defaults")||{};return e=r[t],_.isUndefined(e)&&(e=null),e}},{formatters:{string:function(t,e){return e},number:function(t,e){return Globalize.format(e,"n")},"boolean":function(t,e){return e},date:function(t,e){var r=new Date(e);return Globalize.format(r,"d")},text:function(t,e){return _.unescape(e)},currency:function(t,e){return Globalize.format(e,"c")},percent:function(t,e){return Globalize.format(e,"p")}},converters:{string:function(t,e){return e+""},number:function(t,e){var r=this.string(t,e);return Globalize.parseFloat(r)},"boolean":function(t,e){return Boolean(e)},date:function(t,e){var r=Globalize.parseDate(e)||new Date(e);return r.getTime()},text:function(t,e){var r=this.string(t,e);return r=_.unescape(r),_.escape(r)},currency:function(t,e){return this.number(t,e)},percent:function(t,e){var r=this.number(t,e);return _.isNumber(e)?r:r/100}}})}(Backbone.Model);