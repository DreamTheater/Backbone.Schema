/*!
 * Backbone.Schema v0.1.6
 * https://github.com/DreamTheater/Backbone.Schema
 *
 * Copyright (c) 2013 Dmytro Nemoga
 * Released under the MIT license
 */
(function(){"use strict";var t=Backbone.Model;Backbone.Model=t.extend({readers:{string:function(t,e){return e},number:function(t,e){return Globalize.format(e,"n")},"boolean":function(t,e){return e},date:function(t,e){var r=new Date(e);return Globalize.format(r,"d")},text:function(t,e){return _.unescape(e)},currency:function(t,e){return Globalize.format(e,"c")},percent:function(t,e){return Globalize.format(e,"p")}},writers:{string:function(t,e){return e+""},number:function(t,e){var r=this.writers.string.call(this,t,e);return Globalize.parseFloat(r)},"boolean":function(t,e){return Boolean(e)},date:function(t,e){var r=Globalize.parseDate(e)||new Date(e);return r.getTime()},text:function(t,e){var r=this.writers.string.call(this,t,e);return r=_.unescape(r),_.escape(r)},currency:function(t,e){return this.writers.number.call(this,t,e)},percent:function(t,e){var r=this.writers.number.call(this,t,e);return _.isNumber(e)?r:r/100}},constructor:function(){this._readers={},this._writers={},t.apply(this,arguments)},get:_.wrap(t.prototype.get,function(t,e){var r=t.call(this,e);return this._computeValue(r,e)}),set:_.wrap(t.prototype.set,function(e,r,n,i){var u;_.isObject(r)||!r?(u=r instanceof t?r.attributes:r,i=n):(u={})[r]=n;var s={};return _.each(u,function(t,e,r){var n=this._computeValues(r,e);_.extend(s,n)},this),e.call(this,s,i)}),toJSON:_.wrap(t.prototype.toJSON,function(t,e){e=e||{};var r=t.call(this,e);return e.schema&&_.each(this._readers,function(t,e){r[e]=this.get(e)},this),r}),property:function(t,e){var r=this.get(t),n=this._getDefaultValue(t),i=this.readers[e],u=this.writers[e];return this.computed(t,{reader:i,writer:function(t,e){var r={};return r[t]=_.isNull(e)?e:_.isUndefined(e)?n:u.call(this,t,e),r}}),this.set(t,r,{silent:!0}),this},computed:function(t,e){return this._readers[t]=e.reader,this._writers[t]=e.writer,this},_computeValue:function(t,e){var r=this._readers[e];return r?r.call(this,e,t):t},_computeValues:function(t,e){var r=this._writers[e];return r?r.call(this,e,t[e]):t},_getDefaultValue:function(t){var e,r=_.result(this,"defaults")||{};return e=r[t],_.isUndefined(e)&&(e=null),e}})})();