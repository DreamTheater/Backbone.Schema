/**
 * Backbone.Schema v0.2.0
 * https://github.com/DreamTheater/Backbone.Schema
 *
 * Copyright (c) 2013 Dmytro Nemoga
 * Released under the MIT license
 */
(function(){"use strict";var t=Backbone.Model,r=function(t,r,e){for(var n in t)t.hasOwnProperty(n)&&r.call(e,t[n],n,t)};Backbone.Model=t.extend({constructor:function(r,e){this._formatters={},this._converters={},t.call(this,r,e)},toJSON:_.wrap(t.prototype.toJSON,function(t,e){e=e||{};var n=t.call(this,e);return e.schema&&r(this._formatters,function(t,r){n[r]=this.get(r)},this),n}),get:_.wrap(t.prototype.get,function(t,r){var e=t.call(this,r);return this._formatValue(e,r)}),set:_.wrap(t.prototype.set,function(t,e,n,o){var i;!e||_.isObject(e)?(i=e,o=n):(i={})[e]=n;var u={};return r(i,function(t,r,e){var n=this._convertValues(e,r);_.extend(u,n)},this),t.call(this,u,o)}),property:function(t,r){var e=this.constructor,n=e.formatters,o=n[r],i=e.converters,u=i[r],a=this.attributes[t];return this.computed(t,{getter:_.wrap(o,function(t,r,e){return t.call(n,r,e)}),setter:_.wrap(u,function(t,r,e){var n={};return n[r]=_.isNull(e)?e:_.isUndefined(e)?this._getDefaultValue(r):t.call(i,r,e),n})}),this.set(t,a),this},computed:function(t,r){return this._formatters[t]=r.getter,this._converters[t]=r.setter,this},_formatValue:function(t,r){var e=this._formatters[r];return e?e.call(this,r,t):t},_convertValues:function(t,r){var e=this._converters[r],n=t[r];return e?e.call(this,r,n):t},_getDefaultValue:function(t){var r,e=_.result(this,"defaults")||{};return r=e[t],_.isUndefined(r)&&(r=null),r}},{formatters:{string:function(t,r){return r},number:function(t,r){return Globalize.format(r,"n")},"boolean":function(t,r){return r},date:function(t,r){var e=new Date(r);return Globalize.format(e,"d")},text:function(t,r){return _.unescape(r)},currency:function(t,r){return Globalize.format(r,"c")},percent:function(t,r){return Globalize.format(r,"p")}},converters:{string:function(t,r){return r+""},number:function(t,r){var e=this.string(t,r);return Globalize.parseFloat(e)},"boolean":function(t,r){return Boolean(r)},date:function(t,r){var e=Globalize.parseDate(r)||new Date(r);return e.getTime()},text:function(t,r){var e=this.string(t,r);return e=_.unescape(e),_.escape(e)},currency:function(t,r){return this.number(t,r)},percent:function(t,r){var e=this.number(t,r);return _.isNumber(r)?e:e/100}}})})();