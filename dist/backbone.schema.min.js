/**
 * Backbone.Schema v0.2.5
 * https://github.com/DreamTheater/Backbone.Schema
 *
 * Copyright (c) 2013 Dmytro Nemoga
 * Released under the MIT license
 */
!function(){"use strict";function a(a,b,c){for(var d in a)a.hasOwnProperty(d)&&b.call(c,a[d],d,a)}var b=Backbone.Model;Backbone.Model=b.extend({constructor:function(a,c){this._schema={},this.initialize=_.wrap(this.initialize,function(a,b,c){return a.call(this,b,c)}),b.call(this,a,c)},toJSON:_.wrap(b.prototype.toJSON,function(a,b){var c=a.call(this,b);return _.each(c,function(a,c,d){var e;a&&_.isFunction(e=a.toJSON)&&(d[c]=e.call(a,b))}),c}),get:_.wrap(b.prototype.get,function(a,b){var c=a.call(this,b);return this._formatValue(c,b)}),set:_.wrap(b.prototype.set,function(b,c,d,e){var f;!c||_.isObject(c)?(f=c,e=d):(f={})[c]=d;var g={};return a(f,function(b,c,d){var e=this._convertValue(b,c,d);a(e,function(a,b){g[b]=a})},this),b.call(this,g,e)}),property:function(a,b,c){var d=b.match(/^([-\w]+)(\[\])?$/),e=!!d[2];b=d[1],c=c||{};var f=this.attributes[a],g=this.constructor,h=g.formatters,i=h[b],j=g.converters,k=j[b];return _.defaults(c,{getter:_.wrap(i,function(a,b,d){var f,g=_.isArray(d)?d:[d];return f=_.map(g,function(b){return a.call(h,b,c)}),e?f:f[0]}),setter:_.wrap(k,function(a,d,f){var g={},h=[],i=_.isArray(f)?f:[f];return _.each(i,function(f){var g;g="model"!==b&&"collection"!==b?_.isNull(f)?f:_.isUndefined(f)?e?f:this._getDefaultValue(d):a.call(j,f,c):a.call(j,f,c),_.isUndefined(g)||h.push(g)},this),g[d]=e?h:h[0],g})}),this.computed(a,c),this.set(a,f),this},computed:function(a,b){return this._schema[a]=b,this},_formatValue:function(a,b){var c=this._schema[b]||{},d=c.getter;return d?d.call(this,b,a):a},_convertValue:function(a,b,c){var d=this._schema[b]||{},e=d.setter;return e?e.call(this,b,a):c},_getDefaultValue:function(a){var b,c=_.result(this,"defaults")||{};return b=c[a],_.isUndefined(b)&&(b=null),b}},{formatters:{string:function(a){return a},number:function(a){return Globalize.format(a,"n")},"boolean":function(a){return a},date:function(a){var b=new Date(a);return Globalize.format(b,"d")},text:function(a){return _.unescape(a)},currency:function(a){return Globalize.format(a,"c")},percent:function(a){return Globalize.format(a,"p")},locale:function(a){return Globalize.localize(a)||a},model:function(a){return a},collection:function(a){return a}},converters:{string:function(a){return String(a)},number:function(a){var b=this.string(a);return Globalize.parseFloat(b)},"boolean":function(a){return Boolean(a)},date:function(a){var b=Globalize.parseDate(a)||new Date(a);return b.getTime()},text:function(a){var b=this.string(a);return b=_.unescape(b),_.escape(b)},currency:function(a){return this.number(a)},percent:function(a){var b=this.number(a);return _.isNumber(a)?b:b/100},locale:function(a){var b,c=Globalize.culture(),d=_.pairs(c.messages);return b=_.find(d,function(b){return b[1]===a})||[],b[0]||this.string(a)},model:function(a,b){var c=b.model||Backbone.Model;return a instanceof c?a:new c(a)},collection:function(a,b){var c=b.collection||Backbone.Collection;return a instanceof c?a:new c(a)}}})}();