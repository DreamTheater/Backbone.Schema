/**
 * Backbone.Schema v0.2.1
 * https://github.com/DreamTheater/Backbone.Schema
 *
 * Copyright (c) 2013 Dmytro Nemoga
 * Released under the MIT license
 */
(function(){"use strict";function t(t,e,r){for(var n in t)t.hasOwnProperty(n)&&e.call(r,t[n],n,t)}var e=Backbone.Model;Backbone.Model=e.extend({constructor:function(t,r){this._getters={},this._setters={},e.call(this,t,r)},toJSON:_.wrap(e.prototype.toJSON,function(e,r){r=r||{};var n=e.call(this,r),i=this._getters;return r.schema&&t(i,function(t,e){n[e]=this.get(e)},this),n}),get:_.wrap(e.prototype.get,function(t,e){var r=t.call(this,e);return this._formatValue(r,e)}),set:_.wrap(e.prototype.set,function(e,r,n,i){var u;!r||_.isObject(r)?(u=r,i=n):(u={})[r]=n;var o={};return t(u,function(e,r,n){var i=this._convertValue(e,r,n);t(i,function(t,e){o[e]=t})},this),e.call(this,o,i)}),property:function(t,e){var r=this.constructor,n=r.formatters,i=n[e],u=r.converters,o=u[e],a=this.attributes[t];return this.computed(t,{getter:_.wrap(i,function(t,e,r){return t.call(n,r)}),setter:_.wrap(o,function(t,e,r){var n={};return n[e]=_.isNull(r)?r:_.isUndefined(r)?this._getDefaultValue(e):t.call(u,r),n})}),this.set(t,a),this},computed:function(t,e){return this._getters[t]=e.getter,this._setters[t]=e.setter,this},_formatValue:function(t,e){var r=this._getters[e];return r?r.call(this,e,t):t},_convertValue:function(t,e,r){var n=this._setters[e];return n?n.call(this,e,t):r},_getDefaultValue:function(t){var e,r=_.result(this,"defaults")||{};return e=r[t],_.isUndefined(e)&&(e=null),e}},{formatters:{string:function(t){return t},number:function(t){return Globalize.format(t,"n")},"boolean":function(t){return t},date:function(t){var e=new Date(t);return Globalize.format(e,"d")},text:function(t){return _.unescape(t)},currency:function(t){return Globalize.format(t,"c")},percent:function(t){return Globalize.format(t,"p")}},converters:{string:function(t){return t+""},number:function(t){var e=this.string(t);return Globalize.parseFloat(e)},"boolean":function(t){return Boolean(t)},date:function(t){var e=Globalize.parseDate(t)||new Date(t);return e.getTime()},text:function(t){var e=this.string(t);return e=_.unescape(e),_.escape(e)},currency:function(t){return this.number(t)},percent:function(t){var e=this.number(t);return _.isNumber(t)?e:e/100}}})})();