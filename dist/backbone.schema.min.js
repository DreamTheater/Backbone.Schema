/**
 * Backbone.Schema v0.2.0
 * https://github.com/DreamTheater/Backbone.Schema
 *
 * Copyright (c) 2013 Dmytro Nemoga
 * Released under the MIT license
 */
(function(){"use strict";var t=Backbone.Model;Backbone.Model=t.extend({constructor:function(r,e){this._formatters={},this._converters={},t.call(this,r,e)},toJSON:_.wrap(t.prototype.toJSON,function(t,r){r=r||{};var e=t.call(this,r);return r.schema&&_.each(this._formatters,function(t,r){e[r]=this.get(r)},this),e}),get:_.wrap(t.prototype.get,function(t,r){var e=t.call(this,r);return this._formatValue(e,r)}),set:_.wrap(t.prototype.set,function(t,r,e,n){var o;!r||_.isObject(r)?(o=r,n=e):(o={})[r]=e;var u={};return _.each(o,function(t,r,e){var n=this._convertValues(e,r);_.extend(u,n)},this),t.call(this,u,n)}),property:function(t,r){var e=this.constructor,n=e.formatters,o=n[r],u=e.converters,i=u[r],a=this.attributes[t];return this.computed(t,{getter:_.wrap(o,function(t,r,e){return t.call(n,r,e)}),setter:_.wrap(i,function(t,r,e){var n={};return n[r]=_.isNull(e)?e:_.isUndefined(e)?this._getDefaultValue(r):t.call(u,r,e),n})}),this.set(t,a),this},computed:function(t,r){return this._formatters[t]=r.getter,this._converters[t]=r.setter,this},_formatValue:function(t,r){var e=this._formatters[r];return e?e.call(this,r,t):t},_convertValues:function(t,r){var e=this._converters[r],n=t[r];return e?e.call(this,r,n):t},_getDefaultValue:function(t){var r,e=_.result(this,"defaults")||{};return r=e[t],_.isUndefined(r)&&(r=null),r}},{formatters:{string:function(t,r){return r},number:function(t,r){return Globalize.format(r,"n")},"boolean":function(t,r){return r},date:function(t,r){var e=new Date(r);return Globalize.format(e,"d")},text:function(t,r){return _.unescape(r)},currency:function(t,r){return Globalize.format(r,"c")},percent:function(t,r){return Globalize.format(r,"p")}},converters:{string:function(t,r){return r+""},number:function(t,r){var e=this.string(t,r);return Globalize.parseFloat(e)},"boolean":function(t,r){return Boolean(r)},date:function(t,r){var e=Globalize.parseDate(r)||new Date(r);return e.getTime()},text:function(t,r){var e=this.string(t,r);return e=_.unescape(e),_.escape(e)},currency:function(t,r){return this.number(t,r)},percent:function(t,r){var e=this.number(t,r);return _.isNumber(r)?e:e/100}}})})();