/*!
 * Backbone.Schema v0.1.6
 * https://github.com/DreamTheater/Backbone.Schema
 *
 * Copyright (c) 2013 Dmytro Nemoga
 * Released under the MIT license
 */
(function(){"use strict";var t=Backbone.Model;Backbone.Model=t.extend({readers:{string:function(t,r){return r},number:function(t,r){return Globalize.format(r,"n")},"boolean":function(t,r){return r},date:function(t,r){var e=new Date(r);return Globalize.format(e,"d")},text:function(t,r){return _.unescape(r)},currency:function(t,r){return Globalize.format(r,"c")},percent:function(t,r){return Globalize.format(r,"p")}},writers:{string:function(t,r){return r+""},number:function(t,r){var e=this.writers.string.call(this,t,r);return Globalize.parseFloat(e)},"boolean":function(t,r){return Boolean(r)},date:function(t,r){var e=Globalize.parseDate(r)||new Date(r);return e.getTime()},text:function(t,r){var e=this.writers.string.call(this,t,r);return e=_.unescape(e),_.escape(e)},currency:function(t,r){return this.writers.number.call(this,t,r)},percent:function(t,r){var e=this.writers.number.call(this,t,r);return _.isNumber(r)?e:e/100}},constructor:function(){this._readers={},this._writers={},t.apply(this,arguments)},get:_.wrap(t.prototype.get,function(t,r){var e=t.call(this,r);return this._computeValue(e,r)}),set:_.wrap(t.prototype.set,function(r,e,n,i){var u;_.isObject(e)||!e?(u=e instanceof t?e.attributes:e,i=n):(u={})[e]=n;var a,s={};for(var o in u)a=this._computeValues(u,o),_.extend(s,a);return r.call(this,s,i)}),toJSON:_.wrap(t.prototype.toJSON,function(t,r){r=r||{};var e=t.call(this,r);if(r.schema)for(var n in this._readers)e[n]=this.get(n);return e}),property:function(t,r){var e=this.get(t),n=this._getDefaultValue(t),i=this.readers[r],u=this.writers[r];return this.computed(t,{reader:i,writer:function(t,r){var e={};return e[t]=_.isNull(r)?r:_.isUndefined(r)?n:u.call(this,t,r),e}}),this.set(t,e,{silent:!0})},computed:function(t,r){return this._readers[t]=r.reader,this._writers[t]=r.writer,this},_computeValue:function(t,r){var e=this._readers[r];return e?e.call(this,r,t):t},_computeValues:function(t,r){var e=this._writers[r];return e?e.call(this,r,t[r]):t},_getDefaultValue:function(t){var r,e=_.result(this,"defaults")||{};return r=e[t],_.isUndefined(r)&&(r=null),r}})})();