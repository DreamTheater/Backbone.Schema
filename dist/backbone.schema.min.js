/*!
 * Backbone.Schema v0.1.6
 * https://github.com/DreamTheater/Backbone.Schema
 *
 * Copyright (c) 2013 Dmytro Nemoga
 * Released under the MIT license
 */
(function(){"use strict";var t,e,r;module&&module.exports&&exports?(t=require("underscore"),e=require("backbone"),r=require("globalize")):(t=window._,e=window.Backbone,r=window.Globalize);var n=e.Model;e.Model=n.extend({formatters:{string:function(t,e){return e},number:function(t,e){return r.format(e,"n")},"boolean":function(t,e){return e},date:function(t,e){var n=new Date(e);return r.format(n,"d")},text:function(e,r){return t.unescape(r)},currency:function(t,e){return r.format(e,"c")},percent:function(t,e){return r.format(e,"p")}},converters:{string:function(t,e){return e+""},number:function(t,e){var n=this.converters.string.call(this,t,e);return r.parseFloat(n)},"boolean":function(t,e){return Boolean(e)},date:function(t,e){var n=r.parseDate(e)||new Date(e);return n.getTime()},text:function(e,r){var n=this.converters.string.call(this,e,r);return n=t.unescape(n),t.escape(n)},currency:function(t,e){return this.converters.number.call(this,t,e)},percent:function(e,r){var n=this.converters.number.call(this,e,r);return t.isNumber(r)?n:n/100}},constructor:function(){this._getters={},this._setters={},n.apply(this,arguments)},get:t.wrap(n.prototype.get,function(t,e){var r=t.call(this,e);return this._computeValue(r,e)}),set:t.wrap(n.prototype.set,function(e,r,n,u){var i;!r||t.isObject(r)?(i=r,u=n):(i={})[r]=n;var s={};return t.each(i,function(e,r,n){var u=this._computeValues(n,r);t.extend(s,u)},this),e.call(this,s,u)}),toJSON:t.wrap(n.prototype.toJSON,function(e,r){r=r||{};var n=e.call(this,r);return r.schema&&t.each(this._getters,function(t,e){n[e]=this.get(e)},this),n}),property:function(e,r){var n=this.attributes[e],u=this.formatters[r],i=this.converters[r];return this.computed(e,{getter:t.wrap(u,function(t,e,r){return t.call(this,e,r)}),setter:t.wrap(i,function(e,r,n){var u={};return u[r]=t.isNull(n)?n:t.isUndefined(n)?this._getDefaultValue(r):e.call(this,r,n),u})}),this.set(e,n),this},computed:function(t,e){return this._getters[t]=e.getter,this._setters[t]=e.setter,this},_computeValue:function(t,e){var r=this._getters[e];return r?r.call(this,e,t):t},_computeValues:function(t,e){var r=this._setters[e],n=t[e];return r?r.call(this,e,n):t},_getDefaultValue:function(e){var r,n=t.result(this,"defaults")||{};return r=n[e],t.isUndefined(r)&&(r=null),r}})})();