/**
 * Backbone.Schema v0.2.4
 * https://github.com/DreamTheater/Backbone.Schema
 *
 * Copyright (c) 2013 Dmytro Nemoga
 * Released under the MIT license
 */
!function(){"use strict";function a(a,b,c){for(var d in a)a.hasOwnProperty(d)&&b.call(c,a[d],d,a)}var b=Backbone.Model;Backbone.Model=b.extend({constructor:function(a,c){this._getters={},this._setters={},b.call(this,a,c)},get:_.wrap(b.prototype.get,function(a,b){var c=a.call(this,b);return this._formatValue(c,b)}),set:_.wrap(b.prototype.set,function(b,c,d,e){var f;!c||_.isObject(c)?(f=c,e=d):(f={})[c]=d;var g={};return a(f,function(b,c,d){var e=this._convertValue(b,c,d);a(e,function(a,b){g[b]=a})},this),b.call(this,g,e)}),property:function(a,b){var c=b.match(/^([-\w]+)(\[\])?$/),d=c[1],e=!!c[2],f=this.constructor,g=f.formatters,h=g[d],i=f.converters,j=i[d],k=this.attributes[a];return this.computed(a,{getter:_.wrap(h,function(a,b,c){var d,f=_.isArray(c)?c:[c];return d=_.map(f,function(b){return a.call(g,b)}),e?d:d[0]}),setter:_.wrap(j,function(a,b,c){var d={},f=[],g=_.isArray(c)?c:[c];return _.each(g,function(c,d){var g;g=_.isNull(c)?c:_.isUndefined(c)?this._getDefaultValue(b,e?d:null):a.call(i,c),_.isUndefined(g)||f.push(g)},this),d[b]=e?f:f[0],d})}),this.set(a,k),this},computed:function(a,b){return this._getters[a]=b.getter,this._setters[a]=b.setter,this},_formatValue:function(a,b){var c=this._getters[b];return c?c.call(this,b,a):a},_convertValue:function(a,b,c){var d=this._setters[b];return d?d.call(this,b,a):c},_getDefaultValue:function(a,b){var c,d=_.result(this,"defaults")||{};return c=d[a],_.isNumber(b)?c=(c||[])[b]:_.isUndefined(c)&&(c=null),c}},{formatters:{string:function(a){return a},number:function(a){return Globalize.format(a,"n")},"boolean":function(a){return a},date:function(a){var b=new Date(a);return Globalize.format(b,"d")},text:function(a){return _.unescape(a)},currency:function(a){return Globalize.format(a,"c")},percent:function(a){return Globalize.format(a,"p")},locale:function(a){return Globalize.localize(a)||a}},converters:{string:function(a){return String(a)},number:function(a){var b=this.string(a);return Globalize.parseFloat(b)},"boolean":function(a){return Boolean(a)},date:function(a){var b=Globalize.parseDate(a)||new Date(a);return b.getTime()},text:function(a){var b=this.string(a);return b=_.unescape(b),_.escape(b)},currency:function(a){return this.number(a)},percent:function(a){var b=this.number(a);return _.isNumber(a)?b:b/100},locale:function(a){var b,c=Globalize.culture(),d=_.pairs(c.messages);return b=_.find(d,function(b){return b[1]===a})||[],b[0]||this.string(a)}}})}();